{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "7f2fcc0f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>fips</th>\n",
       "      <th>mmwr_week</th>\n",
       "      <th>recip_county</th>\n",
       "      <th>recip_state</th>\n",
       "      <th>completeness_pct</th>\n",
       "      <th>administered_dose1_recip</th>\n",
       "      <th>administered_dose1_pop_pct</th>\n",
       "      <th>administered_dose1_recip_5plus</th>\n",
       "      <th>administered_dose1_recip_5pluspop_pct</th>\n",
       "      <th>...</th>\n",
       "      <th>booster_doses_vax_pct_ur_equity</th>\n",
       "      <th>booster_doses_12plusvax_pct_ur_equity</th>\n",
       "      <th>booster_doses_18plusvax_pct_ur_equity</th>\n",
       "      <th>booster_doses_65plusvax_pct_ur_equity</th>\n",
       "      <th>census2019</th>\n",
       "      <th>census2019_5pluspop</th>\n",
       "      <th>census2019_5to17pop</th>\n",
       "      <th>census2019_12pluspop</th>\n",
       "      <th>census2019_18pluspop</th>\n",
       "      <th>census2019_65pluspop</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>01091</td>\n",
       "      <td>16</td>\n",
       "      <td>Marengo County</td>\n",
       "      <td>AL</td>\n",
       "      <td>92.5</td>\n",
       "      <td>12646</td>\n",
       "      <td>67</td>\n",
       "      <td>12644</td>\n",
       "      <td>71.4</td>\n",
       "      <td>...</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>18863</td>\n",
       "      <td>17698</td>\n",
       "      <td>3082</td>\n",
       "      <td>16078</td>\n",
       "      <td>14616</td>\n",
       "      <td>3749</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>01111</td>\n",
       "      <td>16</td>\n",
       "      <td>Randolph County</td>\n",
       "      <td>AL</td>\n",
       "      <td>92.5</td>\n",
       "      <td>9169</td>\n",
       "      <td>40.4</td>\n",
       "      <td>9166</td>\n",
       "      <td>42.7</td>\n",
       "      <td>...</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>22722</td>\n",
       "      <td>21444</td>\n",
       "      <td>3519</td>\n",
       "      <td>19577</td>\n",
       "      <td>17925</td>\n",
       "      <td>4741</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>05137</td>\n",
       "      <td>16</td>\n",
       "      <td>Stone County</td>\n",
       "      <td>AR</td>\n",
       "      <td>90.5</td>\n",
       "      <td>5290</td>\n",
       "      <td>42.3</td>\n",
       "      <td>5288</td>\n",
       "      <td>44.5</td>\n",
       "      <td>...</td>\n",
       "      <td>8</td>\n",
       "      <td>8</td>\n",
       "      <td>8</td>\n",
       "      <td>7</td>\n",
       "      <td>12506</td>\n",
       "      <td>11893</td>\n",
       "      <td>1774</td>\n",
       "      <td>10998</td>\n",
       "      <td>10119</td>\n",
       "      <td>3489</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>06003</td>\n",
       "      <td>16</td>\n",
       "      <td>Alpine County</td>\n",
       "      <td>CA</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1129</td>\n",
       "      <td>1080</td>\n",
       "      <td>151</td>\n",
       "      <td>1013</td>\n",
       "      <td>929</td>\n",
       "      <td>298</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>06033</td>\n",
       "      <td>16</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>CA</td>\n",
       "      <td>97.6</td>\n",
       "      <td>42567</td>\n",
       "      <td>66.1</td>\n",
       "      <td>42562</td>\n",
       "      <td>70.2</td>\n",
       "      <td>...</td>\n",
       "      <td>7</td>\n",
       "      <td>7</td>\n",
       "      <td>7</td>\n",
       "      <td>7</td>\n",
       "      <td>64386</td>\n",
       "      <td>60589</td>\n",
       "      <td>9831</td>\n",
       "      <td>55218</td>\n",
       "      <td>50758</td>\n",
       "      <td>14849</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 66 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                      date   fips mmwr_week     recip_county recip_state  \\\n",
       "0  2022-04-19T00:00:00.000  01091        16   Marengo County          AL   \n",
       "1  2022-04-19T00:00:00.000  01111        16  Randolph County          AL   \n",
       "2  2022-04-19T00:00:00.000  05137        16     Stone County          AR   \n",
       "3  2022-04-19T00:00:00.000  06003        16    Alpine County          CA   \n",
       "4  2022-04-19T00:00:00.000  06033        16      Lake County          CA   \n",
       "\n",
       "  completeness_pct administered_dose1_recip administered_dose1_pop_pct  \\\n",
       "0             92.5                    12646                         67   \n",
       "1             92.5                     9169                       40.4   \n",
       "2             90.5                     5290                       42.3   \n",
       "3              NaN                      NaN                        NaN   \n",
       "4             97.6                    42567                       66.1   \n",
       "\n",
       "  administered_dose1_recip_5plus administered_dose1_recip_5pluspop_pct  ...  \\\n",
       "0                          12644                                  71.4  ...   \n",
       "1                           9166                                  42.7  ...   \n",
       "2                           5288                                  44.5  ...   \n",
       "3                            NaN                                   NaN  ...   \n",
       "4                          42562                                  70.2  ...   \n",
       "\n",
       "  booster_doses_vax_pct_ur_equity booster_doses_12plusvax_pct_ur_equity  \\\n",
       "0                               6                                     6   \n",
       "1                               6                                     6   \n",
       "2                               8                                     8   \n",
       "3                             NaN                                   NaN   \n",
       "4                               7                                     7   \n",
       "\n",
       "  booster_doses_18plusvax_pct_ur_equity booster_doses_65plusvax_pct_ur_equity  \\\n",
       "0                                     6                                     6   \n",
       "1                                     6                                     6   \n",
       "2                                     8                                     7   \n",
       "3                                   NaN                                   NaN   \n",
       "4                                     7                                     7   \n",
       "\n",
       "  census2019 census2019_5pluspop census2019_5to17pop census2019_12pluspop  \\\n",
       "0      18863               17698                3082                16078   \n",
       "1      22722               21444                3519                19577   \n",
       "2      12506               11893                1774                10998   \n",
       "3       1129                1080                 151                 1013   \n",
       "4      64386               60589                9831                55218   \n",
       "\n",
       "  census2019_18pluspop census2019_65pluspop  \n",
       "0                14616                 3749  \n",
       "1                17925                 4741  \n",
       "2                10119                 3489  \n",
       "3                  929                  298  \n",
       "4                50758                14849  \n",
       "\n",
       "[5 rows x 66 columns]"
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Dependencies\n",
    "from sodapy import Socrata\n",
    "import json\n",
    "import requests\n",
    "import matplotlib.pyplot as plt\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import requests\n",
    "import time\n",
    "from scipy.stats import linregress\n",
    "from config import appToken\n",
    "\n",
    "# Use open client to obtain data\n",
    "client = Socrata(\"data.cdc.gov\", appToken)\n",
    "results = client.get(\"8xkx-amqh\", limit = 2000000)\n",
    "                     \n",
    "# Convert to pandas DataFrame\n",
    "results_df = pd.DataFrame.from_records(results)\n",
    "results_df.head()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "67c1b443",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['date', 'fips', 'mmwr_week', 'recip_county', 'recip_state',\n",
       "       'completeness_pct', 'administered_dose1_recip',\n",
       "       'administered_dose1_pop_pct', 'administered_dose1_recip_5plus',\n",
       "       'administered_dose1_recip_5pluspop_pct',\n",
       "       'administered_dose1_recip_12plus',\n",
       "       'administered_dose1_recip_12pluspop_pct',\n",
       "       'administered_dose1_recip_18plus',\n",
       "       'administered_dose1_recip_18pluspop_pct',\n",
       "       'administered_dose1_recip_65plus',\n",
       "       'administered_dose1_recip_65pluspop_pct', 'series_complete_yes',\n",
       "       'series_complete_pop_pct', 'series_complete_5plus',\n",
       "       'series_complete_5pluspop_pct', 'series_complete_5to17',\n",
       "       'series_complete_5to17pop_pct', 'series_complete_12plus',\n",
       "       'series_complete_12pluspop_pct', 'series_complete_18plus',\n",
       "       'series_complete_18pluspop_pct', 'series_complete_65plus',\n",
       "       'series_complete_65pluspop_pct', 'booster_doses',\n",
       "       'booster_doses_vax_pct', 'booster_doses_12plus',\n",
       "       'booster_doses_12plus_vax_pct', 'booster_doses_18plus',\n",
       "       'booster_doses_18plus_vax_pct', 'booster_doses_50plus',\n",
       "       'booster_doses_50plus_vax_pct', 'booster_doses_65plus',\n",
       "       'booster_doses_65plus_vax_pct', 'svi_ctgy',\n",
       "       'series_complete_pop_pct_svi', 'series_complete_5pluspop_pct_svi',\n",
       "       'series_complete_5to17pop_pct_svi', 'series_complete_12pluspop_pct_svi',\n",
       "       'series_complete_18pluspop_pct_svi',\n",
       "       'series_complete_65pluspop_pct_svi', 'metro_status',\n",
       "       'series_complete_pop_pct_ur_equity',\n",
       "       'series_complete_5pluspop_pct_ur_equity',\n",
       "       'series_complete_5to17pop_pct_ur_equity',\n",
       "       'series_complete_12pluspop_pct_ur_equity',\n",
       "       'series_complete_18pluspop_pct_ur_equity',\n",
       "       'series_complete_65pluspop_pct_ur_equity', 'booster_doses_vax_pct_svi',\n",
       "       'booster_doses_12plusvax_pct_svi', 'booster_doses_18plusvax_pct_svi',\n",
       "       'booster_doses_65plusvax_pct_svi', 'booster_doses_vax_pct_ur_equity',\n",
       "       'booster_doses_12plusvax_pct_ur_equity',\n",
       "       'booster_doses_18plusvax_pct_ur_equity',\n",
       "       'booster_doses_65plusvax_pct_ur_equity', 'census2019',\n",
       "       'census2019_5pluspop', 'census2019_5to17pop', 'census2019_12pluspop',\n",
       "       'census2019_18pluspop', 'census2019_65pluspop'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results_df.columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "32ef6ceb",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "1618001"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "results_df_columns = results_df[['date','fips','recip_state','recip_county',\n",
    "                                     'completeness_pct','administered_dose1_recip',\n",
    "                                     'administered_dose1_pop_pct','series_complete_yes',\n",
    "                                     'series_complete_pop_pct','metro_status','census2019']]\n",
    "len(results_df_columns)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "385365f7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "1538723"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "clean_df = results_df_columns.dropna()\n",
    "len(clean_df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "bf039053",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>fips</th>\n",
       "      <th>recip_state</th>\n",
       "      <th>recip_county</th>\n",
       "      <th>completeness_pct</th>\n",
       "      <th>administered_dose1_recip</th>\n",
       "      <th>administered_dose1_pop_pct</th>\n",
       "      <th>series_complete_yes</th>\n",
       "      <th>series_complete_pop_pct</th>\n",
       "      <th>metro_status</th>\n",
       "      <th>census2019</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>01091</td>\n",
       "      <td>AL</td>\n",
       "      <td>Marengo County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>12646</td>\n",
       "      <td>67</td>\n",
       "      <td>10250</td>\n",
       "      <td>54.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>18863</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>01111</td>\n",
       "      <td>AL</td>\n",
       "      <td>Randolph County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>9169</td>\n",
       "      <td>40.4</td>\n",
       "      <td>7462</td>\n",
       "      <td>32.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>22722</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>05137</td>\n",
       "      <td>AR</td>\n",
       "      <td>Stone County</td>\n",
       "      <td>90.5</td>\n",
       "      <td>5290</td>\n",
       "      <td>42.3</td>\n",
       "      <td>4540</td>\n",
       "      <td>36.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>12506</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>06033</td>\n",
       "      <td>CA</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.6</td>\n",
       "      <td>42567</td>\n",
       "      <td>66.1</td>\n",
       "      <td>38123</td>\n",
       "      <td>59.2</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>64386</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2022-04-19T00:00:00.000</td>\n",
       "      <td>08065</td>\n",
       "      <td>CO</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.1</td>\n",
       "      <td>5540</td>\n",
       "      <td>68.2</td>\n",
       "      <td>4857</td>\n",
       "      <td>59.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>8127</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                      date   fips recip_state     recip_county  \\\n",
       "0  2022-04-19T00:00:00.000  01091          AL   Marengo County   \n",
       "1  2022-04-19T00:00:00.000  01111          AL  Randolph County   \n",
       "2  2022-04-19T00:00:00.000  05137          AR     Stone County   \n",
       "4  2022-04-19T00:00:00.000  06033          CA      Lake County   \n",
       "5  2022-04-19T00:00:00.000  08065          CO      Lake County   \n",
       "\n",
       "  completeness_pct administered_dose1_recip administered_dose1_pop_pct  \\\n",
       "0             92.5                    12646                         67   \n",
       "1             92.5                     9169                       40.4   \n",
       "2             90.5                     5290                       42.3   \n",
       "4             97.6                    42567                       66.1   \n",
       "5             97.1                     5540                       68.2   \n",
       "\n",
       "  series_complete_yes series_complete_pop_pct metro_status census2019  \n",
       "0               10250                    54.3    Non-metro      18863  \n",
       "1                7462                    32.8    Non-metro      22722  \n",
       "2                4540                    36.3    Non-metro      12506  \n",
       "4               38123                    59.2    Non-metro      64386  \n",
       "5                4857                    59.8    Non-metro       8127  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "clean_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "263ff57a",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\isidh\\AppData\\Local\\Temp/ipykernel_10712/741940049.py:1: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  clean_df['date'] = pd.to_datetime(clean_df['date']).dt.date\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>fips</th>\n",
       "      <th>recip_state</th>\n",
       "      <th>recip_county</th>\n",
       "      <th>completeness_pct</th>\n",
       "      <th>administered_dose1_recip</th>\n",
       "      <th>administered_dose1_pop_pct</th>\n",
       "      <th>series_complete_yes</th>\n",
       "      <th>series_complete_pop_pct</th>\n",
       "      <th>metro_status</th>\n",
       "      <th>census2019</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>01091</td>\n",
       "      <td>AL</td>\n",
       "      <td>Marengo County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>12646</td>\n",
       "      <td>67</td>\n",
       "      <td>10250</td>\n",
       "      <td>54.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>18863</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>01111</td>\n",
       "      <td>AL</td>\n",
       "      <td>Randolph County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>9169</td>\n",
       "      <td>40.4</td>\n",
       "      <td>7462</td>\n",
       "      <td>32.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>22722</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>05137</td>\n",
       "      <td>AR</td>\n",
       "      <td>Stone County</td>\n",
       "      <td>90.5</td>\n",
       "      <td>5290</td>\n",
       "      <td>42.3</td>\n",
       "      <td>4540</td>\n",
       "      <td>36.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>12506</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>06033</td>\n",
       "      <td>CA</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.6</td>\n",
       "      <td>42567</td>\n",
       "      <td>66.1</td>\n",
       "      <td>38123</td>\n",
       "      <td>59.2</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>64386</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>08065</td>\n",
       "      <td>CO</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.1</td>\n",
       "      <td>5540</td>\n",
       "      <td>68.2</td>\n",
       "      <td>4857</td>\n",
       "      <td>59.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>8127</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date   fips recip_state     recip_county completeness_pct  \\\n",
       "0  2022-04-19  01091          AL   Marengo County             92.5   \n",
       "1  2022-04-19  01111          AL  Randolph County             92.5   \n",
       "2  2022-04-19  05137          AR     Stone County             90.5   \n",
       "4  2022-04-19  06033          CA      Lake County             97.6   \n",
       "5  2022-04-19  08065          CO      Lake County             97.1   \n",
       "\n",
       "  administered_dose1_recip administered_dose1_pop_pct series_complete_yes  \\\n",
       "0                    12646                         67               10250   \n",
       "1                     9169                       40.4                7462   \n",
       "2                     5290                       42.3                4540   \n",
       "4                    42567                       66.1               38123   \n",
       "5                     5540                       68.2                4857   \n",
       "\n",
       "  series_complete_pop_pct metro_status census2019  \n",
       "0                    54.3    Non-metro      18863  \n",
       "1                    32.8    Non-metro      22722  \n",
       "2                    36.3    Non-metro      12506  \n",
       "4                    59.2    Non-metro      64386  \n",
       "5                    59.8    Non-metro       8127  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "clean_df['date'] = pd.to_datetime(clean_df['date']).dt.date\n",
    "clean_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "5bb27366",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\isidh\\AppData\\Local\\Temp/ipykernel_10712/4293168796.py:1: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  clean_df['month'] = pd.DatetimeIndex(clean_df['date']).month\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>fips</th>\n",
       "      <th>recip_state</th>\n",
       "      <th>recip_county</th>\n",
       "      <th>completeness_pct</th>\n",
       "      <th>administered_dose1_recip</th>\n",
       "      <th>administered_dose1_pop_pct</th>\n",
       "      <th>series_complete_yes</th>\n",
       "      <th>series_complete_pop_pct</th>\n",
       "      <th>metro_status</th>\n",
       "      <th>census2019</th>\n",
       "      <th>month</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>01091</td>\n",
       "      <td>AL</td>\n",
       "      <td>Marengo County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>12646</td>\n",
       "      <td>67</td>\n",
       "      <td>10250</td>\n",
       "      <td>54.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>18863</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>01111</td>\n",
       "      <td>AL</td>\n",
       "      <td>Randolph County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>9169</td>\n",
       "      <td>40.4</td>\n",
       "      <td>7462</td>\n",
       "      <td>32.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>22722</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>05137</td>\n",
       "      <td>AR</td>\n",
       "      <td>Stone County</td>\n",
       "      <td>90.5</td>\n",
       "      <td>5290</td>\n",
       "      <td>42.3</td>\n",
       "      <td>4540</td>\n",
       "      <td>36.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>12506</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>06033</td>\n",
       "      <td>CA</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.6</td>\n",
       "      <td>42567</td>\n",
       "      <td>66.1</td>\n",
       "      <td>38123</td>\n",
       "      <td>59.2</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>64386</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>08065</td>\n",
       "      <td>CO</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.1</td>\n",
       "      <td>5540</td>\n",
       "      <td>68.2</td>\n",
       "      <td>4857</td>\n",
       "      <td>59.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>8127</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date   fips recip_state     recip_county completeness_pct  \\\n",
       "0  2022-04-19  01091          AL   Marengo County             92.5   \n",
       "1  2022-04-19  01111          AL  Randolph County             92.5   \n",
       "2  2022-04-19  05137          AR     Stone County             90.5   \n",
       "4  2022-04-19  06033          CA      Lake County             97.6   \n",
       "5  2022-04-19  08065          CO      Lake County             97.1   \n",
       "\n",
       "  administered_dose1_recip administered_dose1_pop_pct series_complete_yes  \\\n",
       "0                    12646                         67               10250   \n",
       "1                     9169                       40.4                7462   \n",
       "2                     5290                       42.3                4540   \n",
       "4                    42567                       66.1               38123   \n",
       "5                     5540                       68.2                4857   \n",
       "\n",
       "  series_complete_pop_pct metro_status census2019  month  \n",
       "0                    54.3    Non-metro      18863      4  \n",
       "1                    32.8    Non-metro      22722      4  \n",
       "2                    36.3    Non-metro      12506      4  \n",
       "4                    59.2    Non-metro      64386      4  \n",
       "5                    59.8    Non-metro       8127      4  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "clean_df['month'] = pd.DatetimeIndex(clean_df['date']).month\n",
    "clean_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "a69ffe3c",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\isidh\\AppData\\Local\\Temp/ipykernel_10712/354663647.py:1: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  clean_df['quarter'] = pd.DatetimeIndex(clean_df['date']).quarter\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>fips</th>\n",
       "      <th>recip_state</th>\n",
       "      <th>recip_county</th>\n",
       "      <th>completeness_pct</th>\n",
       "      <th>administered_dose1_recip</th>\n",
       "      <th>administered_dose1_pop_pct</th>\n",
       "      <th>series_complete_yes</th>\n",
       "      <th>series_complete_pop_pct</th>\n",
       "      <th>metro_status</th>\n",
       "      <th>census2019</th>\n",
       "      <th>month</th>\n",
       "      <th>quarter</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>01091</td>\n",
       "      <td>AL</td>\n",
       "      <td>Marengo County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>12646</td>\n",
       "      <td>67</td>\n",
       "      <td>10250</td>\n",
       "      <td>54.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>18863</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>01111</td>\n",
       "      <td>AL</td>\n",
       "      <td>Randolph County</td>\n",
       "      <td>92.5</td>\n",
       "      <td>9169</td>\n",
       "      <td>40.4</td>\n",
       "      <td>7462</td>\n",
       "      <td>32.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>22722</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>05137</td>\n",
       "      <td>AR</td>\n",
       "      <td>Stone County</td>\n",
       "      <td>90.5</td>\n",
       "      <td>5290</td>\n",
       "      <td>42.3</td>\n",
       "      <td>4540</td>\n",
       "      <td>36.3</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>12506</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>06033</td>\n",
       "      <td>CA</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.6</td>\n",
       "      <td>42567</td>\n",
       "      <td>66.1</td>\n",
       "      <td>38123</td>\n",
       "      <td>59.2</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>64386</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2022-04-19</td>\n",
       "      <td>08065</td>\n",
       "      <td>CO</td>\n",
       "      <td>Lake County</td>\n",
       "      <td>97.1</td>\n",
       "      <td>5540</td>\n",
       "      <td>68.2</td>\n",
       "      <td>4857</td>\n",
       "      <td>59.8</td>\n",
       "      <td>Non-metro</td>\n",
       "      <td>8127</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date   fips recip_state     recip_county completeness_pct  \\\n",
       "0  2022-04-19  01091          AL   Marengo County             92.5   \n",
       "1  2022-04-19  01111          AL  Randolph County             92.5   \n",
       "2  2022-04-19  05137          AR     Stone County             90.5   \n",
       "4  2022-04-19  06033          CA      Lake County             97.6   \n",
       "5  2022-04-19  08065          CO      Lake County             97.1   \n",
       "\n",
       "  administered_dose1_recip administered_dose1_pop_pct series_complete_yes  \\\n",
       "0                    12646                         67               10250   \n",
       "1                     9169                       40.4                7462   \n",
       "2                     5290                       42.3                4540   \n",
       "4                    42567                       66.1               38123   \n",
       "5                     5540                       68.2                4857   \n",
       "\n",
       "  series_complete_pop_pct metro_status census2019  month  quarter  \n",
       "0                    54.3    Non-metro      18863      4        2  \n",
       "1                    32.8    Non-metro      22722      4        2  \n",
       "2                    36.3    Non-metro      12506      4        2  \n",
       "4                    59.2    Non-metro      64386      4        2  \n",
       "5                    59.8    Non-metro       8127      4        2  "
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "clean_df['quarter'] = pd.DatetimeIndex(clean_df['date']).quarter\n",
    "clean_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6db757ed",
   "metadata": {},
   "outputs": [],
   "source": [
    "# states_df = clean_df.loc[(clean_df['recip_state'] == 'CA') | (clean_df['recip_state'] == 'TX'),:]\n",
    "# states_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "9f7e12c0",
   "metadata": {},
   "outputs": [],
   "source": [
    "grouped_fips = clean_df.groupby(['fips'])\n",
    "max_group = grouped_fips.max()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "2622033d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "3211"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(max_group)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "4f1df5a9",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>administered_dose1_recip</th>\n",
       "      <th>administered_dose1_pop_pct</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>fips</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>01001</th>\n",
       "      <td>9887</td>\n",
       "      <td>9.8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>01003</th>\n",
       "      <td>99831</td>\n",
       "      <td>9.7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>01005</th>\n",
       "      <td>9626</td>\n",
       "      <td>9.8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>01007</th>\n",
       "      <td>9522</td>\n",
       "      <td>9.8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>01009</th>\n",
       "      <td>9930</td>\n",
       "      <td>9.9</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      administered_dose1_recip administered_dose1_pop_pct\n",
       "fips                                                     \n",
       "01001                     9887                        9.8\n",
       "01003                    99831                        9.7\n",
       "01005                     9626                        9.8\n",
       "01007                     9522                        9.8\n",
       "01009                     9930                        9.9"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "max_dose = pd.DataFrame(max_group[['administered_dose1_recip','administered_dose1_pop_pct']]) \n",
    "max_dose.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "0700333f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "3211"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(max_dose)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "34db812c",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "3211"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "test = max_dose.dropna()\n",
    "len(test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ed09acb9",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:PythonData38] *",
   "language": "python",
   "name": "conda-env-PythonData38-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
